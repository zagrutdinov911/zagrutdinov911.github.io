<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ProCalc –û–ì–ó | –í–µ—Ä—Å–∏—è 4.0 (–ú—É–ª—å—Ç–∏-—Å–∏—Å—Ç–µ–º–∞)</title>
    <style>
        :root { --primary: #1a73e8; --bg: #f4f6f9; --card-bg: #ffffff; --text-main: #202124; --text-muted: #5f6368; --border: #dadce0; --shop: #9c27b0; --site: #e91e63; --joints: #ff9800; --success: #0f9d58;}
        body { font-family: 'Segoe UI', Roboto, sans-serif; background: var(--bg); color: var(--text-main); margin: 0; padding: 20px; }
        .header { text-align: center; margin-bottom: 30px; }
        .header h1 { margin: 0; color: var(--primary); }
        .container { max-width: 1200px; margin: 0 auto; }
        
        .card { background: var(--card-bg); border-radius: 12px; padding: 20px; border: 1px solid var(--border); box-shadow: 0 4px 6px rgba(0,0,0,0.05); margin-bottom: 20px;}
        .card h2 { font-size: 18px; margin-top: 0; margin-bottom: 20px; border-bottom: 2px solid var(--bg); padding-bottom: 10px; display: flex; justify-content: space-between; align-items: center;}
        
        .form-grid-2 { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 15px; }
        .form-grid-3 { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 15px; margin-bottom: 15px; }
        .form-group-full { margin-bottom: 15px; }
        
        label { display: block; font-size: 12px; font-weight: 600; color: var(--text-muted); margin-bottom: 6px; text-transform: uppercase; }
        input, select { width: 100%; padding: 10px; border: 1px solid var(--border); border-radius: 8px; font-size: 15px; box-sizing: border-box; background: #fafbfc; transition: 0.2s;}
        input:focus, select:focus { outline: none; border-color: var(--primary); background: #fff; }
        
        .btn-add { background: #e8f0fe; color: var(--primary); border: 1px dashed var(--primary); padding: 15px; width: 100%; border-radius: 10px; font-weight: bold; cursor: pointer; font-size: 16px; margin-bottom: 30px; transition: 0.2s;}
        .btn-add:hover { background: #d2e3fc; }
        
        .btn-remove { background: #ffebee; color: #d32f2f; border: none; padding: 5px 10px; border-radius: 6px; cursor: pointer; font-size: 12px; font-weight: bold;}
        
        .btn-calc { display: block; width: 100%; max-width: 400px; margin: 30px auto; background: var(--primary); color: white; border: none; padding: 16px; font-size: 18px; font-weight: bold; border-radius: 10px; cursor: pointer; box-shadow: 0 4px 15px rgba(26,115,232,0.3);}
        .btn-calc:hover { transform: translateY(-2px); }
        
        .mesh-box { display: none; background-color: #e8f0fe; padding: 10px; border-radius: 8px; margin-top: 10px; border: 1px dashed var(--primary); }
        
        /* –°—Ç–∏–ª–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ */
        #result-section { display: none; margin-bottom: 40px; }
        .sys-result { margin-bottom: 30px; border: 2px solid var(--border); border-radius: 12px; padding: 20px; background: #fff;}
        .sys-result-title { font-size: 20px; font-weight: bold; color: var(--primary); margin-bottom: 15px; border-bottom: 2px solid var(--bg); padding-bottom: 10px;}
        
        .res-row { display: flex; gap: 15px; margin-bottom: 15px; flex-wrap: wrap;}
        .res-container { flex: 1; min-width: 300px; background: #fff; border-left: 5px solid; border-radius: 8px; padding: 15px; box-shadow: 0 2px 8px rgba(0,0,0,0.06);}
        .res-container.shop { border-color: var(--shop); }
        .res-container.site { border-color: var(--site); }
        .res-container.joints { border-color: var(--joints); }
        
        .res-title { font-size: 14px; font-weight: bold; margin-bottom: 10px; text-transform: uppercase; color: var(--text-main);}
        .res-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 8px; }
        .res-box { background: var(--bg); padding: 10px; border-radius: 6px; text-align: center;}
        .res-box span { display: block; font-size: 10px; color: var(--text-muted); text-transform: uppercase; margin-bottom: 2px;}
        .res-box strong { font-size: 15px; color: var(--text-main); }
        .res-box.main { background: #fff3e0; border: 1px solid #ffe0b2; grid-column: span 2;} 
        .res-box.main strong { color: #d84315; font-size: 18px;}
        
        /* –ì—Ä–∞–Ω–¥ –ò—Ç–æ–≥–æ */
        .grand-total { background: #e8f5e9; border: 2px solid var(--success); border-radius: 12px; padding: 20px; text-align: center; box-shadow: 0 8px 20px rgba(15, 157, 88, 0.15);}
        .grand-title { font-size: 24px; font-weight: bold; color: var(--success); margin-bottom: 20px; text-transform: uppercase;}
        .gt-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; }
        .gt-box { background: white; padding: 15px; border-radius: 8px; }
        .gt-box span { display: block; font-size: 12px; color: var(--text-muted); text-transform: uppercase;}
        .gt-box strong { font-size: 22px; color: var(--text-main); }
        .gt-box.main strong { color: var(--success); font-size: 28px;}
    </style>
</head>
<body>
    <div style="background: #1a73e8; padding: 10px 0; margin-bottom: 20px; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
    <div style="max-width: 1200px; margin: 0 auto; display: flex; justify-content: space-between; align-items: center; padding: 0 20px;">
        <span style="color: white; font-weight: bold; font-size: 18px;">LNK-EXPERT –ì–ï–û</span>
        <nav>
            <a href="index.html" style="color: white; text-decoration: none; margin-left: 20px; font-size: 14px; opacity: 0.9;">–ì–ª–∞–≤–Ω–∞—è</a>
            <a href="pro.html" style="color: white; text-decoration: none; margin-left: 20px; font-size: 14px; border-bottom: 2px solid white; padding-bottom: 5px;">PRO –ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä</a>
            <a href="https://lnkexpert.ru" target="_blank" style="color: white; text-decoration: none; margin-left: 20px; font-size: 14px; opacity: 0.9;">–ù–∞ –æ—Å–Ω–æ–≤–Ω–æ–π —Å–∞–π—Ç</a>
        </nav>
    </div>
</div>

<div class="header">
    <h1>PRO –û–ì–ó –†–∞—Å—á–µ—Ç</h1>
    <p>–†–∞–±–æ—á–∏–π –ø—Ä–æ—Ç–æ—Ç–∏–ø (–í–µ—Ä—Å–∏—è 4.0 - –ú—É–ª—å—Ç–∏-—Å–∏—Å—Ç–µ–º–∞)</p>
</div>

<div class="container">
    
    <div id="result-section"></div>

    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(400px, 1fr)); gap: 20px; margin-bottom: 20px;">
        <div class="card" style="margin-bottom: 0;">
            <h2>üí∞ –§–∏–Ω–∞–Ω—Å—ã –∏ –†–µ–∂–∏–º</h2>
            <div class="form-grid-2">
                <div><label>–°—Ç–∞–≤–∫–∞ –ó–∞–∫–∞–∑—á–∏–∫–∞ –ß–ß (‚ÇΩ)</label><input type="number" id="rate-labor" value="893"></div>
                <div><label>–°—Ç–∞–≤–∫–∞ –ó–∞–∫–∞–∑—á–∏–∫–∞ –ú–ß (‚ÇΩ)</label><input type="number" id="rate-machine" value="2100"></div>
            </div>
            <div class="form-group-full">
                <label>–ó–ü —Ä–∞–±–æ—á–µ–≥–æ –∑–∞ —Å–º–µ–Ω—É (‚ÇΩ –Ω–∞ —Ä—É–∫–∏)</label><input type="number" id="rate-worker" value="15000">
            </div>
            <div class="form-grid-2">
                <div><label>–ß–∞—Å–æ–≤ –≤ —Å–º–µ–Ω–µ</label><input type="number" id="shift-hours" value="8"></div>
                <div><label>–î–Ω–µ–π –≤ –º–µ—Å—è—Ü–µ</label><input type="number" id="month-days" value="22"></div>
            </div>
        </div>

        <div class="card" style="margin-bottom: 0;">
            <h2>üìà –ù–∞–∫—Ä—É—Ç–∫–∏ (–ö–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç—ã)</h2>
            <div class="form-grid-2">
                <div style="background: #f3e5f5; padding: 10px; border-radius: 8px;">
                    <label style="color: #7b1fa2;">–ö–æ—Å–≤–µ–Ω–Ω—ã–µ (–¶–µ—Ö) %</label>
                    <input type="number" id="coef-indirect-shop" value="0">
                </div>
                <div style="background: #fff8e1; padding: 10px; border-radius: 8px;">
                    <label style="color: #b08d00;">–ö–æ—Å–≤–µ–Ω–Ω—ã–µ (–ü–ª–æ—â–∞–¥–∫–∞) %</label>
                    <input type="number" id="coef-indirect-site" value="0">
                </div>
            </div>
            <div class="form-grid-2">
                <div><label>–ü—Ä–∏–±—ã–ª—å (%)</label><input type="number" id="coef-profit" value="0"></div>
                <div><label>–†–∏—Å–∫–∏ (%)</label><input type="number" id="coef-risk" value="0"></div>
            </div>
        </div>
    </div>

    <div id="systems-container">
        </div>

    <button class="btn-add" onclick="addSystem()">+ –î–û–ë–ê–í–ò–¢–¨ –°–ò–°–¢–ï–ú–£ –û–ì–ó (–ù–æ–≤—ã–π —ç–ª–µ–º–µ–Ω—Ç / –ó–¥–∞–Ω–∏–µ)</button>

    <button class="btn-calc" onclick="calculateAll()">–†–ê–°–°–ß–ò–¢–ê–¢–¨ –í–ï–°–¨ –ü–†–û–ï–ö–¢</button>

</div>

<template id="system-template">
    <div class="card system-block">
        <h2>
            <input type="text" class="sys-name" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ (–Ω–∞–ø—Ä. –ö–æ–ª–æ–Ω–Ω—ã R90)" style="width: 60%; font-size: 16px; font-weight: bold; border-color: transparent; border-bottom: 1px solid var(--primary); border-radius: 0; padding: 5px;">
            <button class="btn-remove" onclick="removeSystem(this)">‚úñ –£–¥–∞–ª–∏—Ç—å</button>
        </h2>
        
        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(350px, 1fr)); gap: 20px;">
            
            <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; border: 1px solid var(--border);">
                <h3 style="margin-top: 0; font-size: 14px; color: var(--primary);">‚öôÔ∏è –ü–∏—Ä–æ–≥ —Å–∏—Å—Ç–µ–º—ã</h3>
                <div class="form-group-full">
                    <label>–°–æ—Å—Ç–æ—è–Ω–∏–µ –º–µ—Ç–∞–ª–ª–∞</label>
                    <select class="metal-state">
                        <option value="bare">–ì–æ–ª—ã–π –º–µ—Ç–∞–ª–ª (–ö–æ–º–ø–ª–µ–∫—Å –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∏)</option>
                        <option value="primed">–ó–∞–≤–æ–¥—Å–∫–æ–π –≥—Ä—É–Ω—Ç (–¢–æ–ª—å–∫–æ –æ–±–µ–∑–∂–∏—Ä–∫–∞)</option>
                    </select>
                </div>
                <div class="form-grid-2">
                    <div><label>–ì—Ä—É–Ω—Ç (–º–∫–º)</label><input type="number" class="primer-thk" value="50"></div>
                    <div><label>–°–ª–æ–µ–≤ –≥—Ä—É–Ω—Ç–∞</label><input type="number" class="primer-layers" value="1"></div>
                </div>
                <div class="form-grid-2">
                    <div><label>–û–ì–ó –¢–æ–ª—â–∏–Ω–∞ (–º–∫–º)</label><input type="number" class="ogz-thk" value="2000"></div>
                    <div><label>–û–ì–ó –ú–∞–∫—Å. —Å–ª–æ–π</label><input type="number" class="ogz-max-layer" value="2000"></div>
                </div>
                
                <div class="form-group-full">
                    <label>–ê—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ (–°–µ—Ç–∫–∞)</label>
                    <select class="mesh-type" onchange="toggleMesh(this)">
                        <option value="none">–ë–µ–∑ —Å–µ—Ç–∫–∏</option>
                        <option value="by_layer">–ñ–µ—Å—Ç–∫–æ –ø–æ—Å–ª–µ —Å–ª–æ—è ‚Ññ...</option>
                        <option value="by_thickness">–ñ–µ—Å—Ç–∫–æ –ø–æ—Å–ª–µ —Ç–æ–ª—â–∏–Ω—ã (–º–∫–º)...</option>
                        <option value="proportional">–ü—Ä–æ–ø–æ—Ä—Ü–∏–æ–Ω–∞–ª—å–Ω–æ (–Ω–∞–ø—Ä. 0.5)</option>
                    </select>
                    <div class="mesh-box">
                        <label class="mesh-label" style="color: var(--primary);">–ó–Ω–∞—á–µ–Ω–∏–µ</label>
                        <input type="number" class="mesh-value" placeholder="0" value="0">
                    </div>
                </div>

                <div class="form-grid-2">
                    <div><label>–§–∏–Ω–∏—à (–º–∫–º)</label><input type="number" class="finish-thk" value="50"></div>
                    <div><label>–°–ª–æ–µ–≤ —Ñ–∏–Ω–∏—à–∞</label><input type="number" class="finish-layers" value="1"></div>
                </div>
            </div>

            <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; border: 1px solid var(--border);">
                <h3 style="margin-top: 0; font-size: 14px; color: var(--primary);">üèóÔ∏è –û–±—ä–µ–º—ã –¥–ª—è —ç—Ç–æ–π —Å–∏—Å—Ç–µ–º—ã</h3>
                
                <div class="form-grid-2" style="background: #fff; padding: 10px; border-radius: 6px; border: 1px solid #e0e0e0;">
                    <div><label>üè≠ –ü–ª–æ—â–∞–¥—å –≤ –¶–µ—Ö—É (–º2)</label><input type="number" class="area-shop" value="0"></div>
                    <div><label>–ö–æ—ç—Ñ—Ñ. –¶–µ—Ö–∞ (K)</label><input type="number" step="0.1" class="shop-coef" value="1.0"></div>
                </div>
                
                <div class="form-grid-3" style="background: #fff; padding: 10px; border-radius: 6px; border: 1px solid #e0e0e0; margin-top: 10px;">
                    <div><label>üèóÔ∏è –ü–ª–æ—â–∞–¥–∫–∞ (–º2)</label><input type="number" class="area-site" value="0"></div>
                    <div>
                        <label>–î–æ—Å—Ç—É–ø</label>
                        <select class="access-type">
                            <option>–ó–µ–º–ª—è/–ª–µ—Å–∞</option>
                            <option>–ü—Ä–æ–º. –∞–ª—å–ø–∏–Ω–∏–∑–º</option>
                        </select>
                    </div>
                    <div><label>–ö–æ—ç—Ñ—Ñ. (K)</label><input type="number" step="0.1" class="access-coef" value="1.0"></div>
                </div>

                <div style="background: #fff; padding: 10px; border-radius: 6px; border: 1px solid #e0e0e0; margin-top: 10px;">
                    <label style="color: var(--joints);">üîó –ú–æ–Ω—Ç–∞–∂–Ω—ã–µ —Å—Ç—ã–∫–∏</label>
                    <div class="form-grid-3">
                        <div><label>–≠–ª–µ–º–µ–Ω—Ç–æ–≤</label><input type="number" class="joint-elements" value="0"></div>
                        <div><label>–°—Ç—ã–∫–æ–≤/—ç–ª.</label><input type="number" class="joints-per-element" value="0"></div>
                        <div><label>S 1 —Å—Ç—ã–∫–∞ (–º2)</label><input type="number" step="0.01" class="joint-area" value="0.1"></div>
                    </div>
                    <div><label>–ö–æ—ç—Ñ—Ñ. —É—Å–ª–æ–≤–∏–π (–Ω–∞ —Å—Ç—ã–∫–∏)</label><input type="number" step="0.1" class="joints-coef" value="1.0"></div>
                </div>
            </div>

        </div>
    </div>
</template>

<script>
    let systemCount = 0;

    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø–µ—Ä–≤–æ–π —Å–∏—Å—Ç–µ–º—ã –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
    window.onload = function() { addSystem(); };

    function addSystem() {
        systemCount++;
        const container = document.getElementById('systems-container');
        const template = document.getElementById('system-template');
        const clone = template.content.cloneNode(true);
        
        // –ê–≤—Ç–æ–Ω–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ
        clone.querySelector('.sys-name').value = `–°–∏—Å—Ç–µ–º–∞ –û–ì–ó ‚Ññ${systemCount}`;
        
        // –°–∫—Ä—ã–≤–∞–µ–º –∫–Ω–æ–ø–∫—É —É–¥–∞–ª–µ–Ω–∏—è —É —Å–∞–º–æ–π –ø–µ—Ä–≤–æ–π —Å–∏—Å—Ç–µ–º—ã (—á—Ç–æ–±—ã –≤—Å–µ–≥–¥–∞ –±—ã–ª–∞ —Ö–æ—Ç—è –±—ã –æ–¥–Ω–∞)
        if (container.children.length === 0) {
            clone.querySelector('.btn-remove').style.display = 'none';
        }
        
        container.appendChild(clone);
    }

    function removeSystem(btn) {
        btn.closest('.system-block').remove();
    }

    function toggleMesh(selectElement) {
        const box = selectElement.parentElement.querySelector('.mesh-box');
        const label = box.querySelector('.mesh-label');
        const val = selectElement.value;
        
        if (val === 'none') { box.style.display = 'none'; } 
        else {
            box.style.display = 'block';
            if (val === 'by_layer') label.innerText = '–ü–æ—Å–ª–µ –∫–∞–∫–æ–≥–æ —Å–ª–æ—è?';
            else if (val === 'by_thickness') label.innerText = '–ü–æ—Å–ª–µ —Ç–æ–ª—â–∏–Ω—ã (–º–∫–º)?';
            else if (val === 'proportional') label.innerText = '–î–æ–ª—è (–Ω–∞–ø—Ä. 0.5)?';
        }
    }

    // –ë–ê–ó–ê –ù–û–†–ú–ê–¢–ò–í–û–í (–ò–¥–µ–Ω—Ç–∏—á–Ω–∞ –í–µ—Ä—Å–∏–∏ 3.7)
    const NORMS = {
        solid: {
            prep_sa25: { labor: 0.26, machine: 0.49 }, prep_dust: { labor: 0.1, machine: 0.1 },
            prep_degrease: { labor: 0.908, machine: 0 }, primer: { labor: 0.0464, machine: 0.0112 },
            ogz_layer: { labor: 2.3, machine: 0.4 }, mesh: { labor: 0.262, machine: 0 },
            mesh_spray: { labor: 0.0464, machine: 0.0112 }, finish: { labor: 0.0464, machine: 0.0112 }
        },
        joints: {
            prep_complex: 10, prep_degrease: 15, primer: 15, 
            ogz_layer: 5, mesh: 5, mesh_spray: 10, finish: 15
        }
    };

    function calculateAll() {
        // –ß–¢–ï–ù–ò–ï –ì–õ–û–ë–ê–õ–¨–ù–´–• –ü–ê–†–ê–ú–ï–¢–†–û–í
        const rateLabor = parseFloat(document.getElementById('rate-labor').value) || 0;
        const rateMachine = parseFloat(document.getElementById('rate-machine').value) || 0;
        const rateWorker = parseFloat(document.getElementById('rate-worker').value) || 0;
        const shiftHours = parseFloat(document.getElementById('shift-hours').value) || 8;
        const marketRateHour = rateWorker / shiftHours;
        
        const kIndShop = 1 + ((parseFloat(document.getElementById('coef-indirect-shop').value) || 0) / 100);
        const kIndSite = 1 + ((parseFloat(document.getElementById('coef-indirect-site').value) || 0) / 100);
        const kProfit = 1 + ((parseFloat(document.getElementById('coef-profit').value) || 0) / 100);
        const kRisk = 1 + ((parseFloat(document.getElementById('coef-risk').value) || 0) / 100);

        // –§–£–ù–ö–¶–ò–Ø –≠–ö–û–ù–û–ú–ò–ö–ò
        function calcEconomics(l, m, kIndirect) {
            let direct = (l * rateLabor) + (m * rateMachine);
            let base = direct * kIndirect;
            let finalP = base * kProfit * kRisk;
            let market = (l * marketRateHour) + (m * rateMachine);
            return { finalP, market };
        }

        const fmtM = (num) => new Intl.NumberFormat('ru-RU', {minimumFractionDigits: 2, maximumFractionDigits: 2}).format(num);
        const fmtD = (num) => parseFloat(num).toFixed(2);

        let resultHTML = "";
        
        // –ü–ï–†–ï–ú–ï–ù–ù–´–ï –ì–†–ê–ù–î –ò–¢–û–ì–û
        let grandLabor = 0, grandMachine = 0, grandPrice = 0, grandCost = 0;

        // –ü–ï–†–ï–ë–û–† –í–°–ï–• –°–ò–°–¢–ï–ú
        const systems = document.querySelectorAll('.system-block');
        
        systems.forEach((sys) => {
            const sysName = sys.querySelector('.sys-name').value || "–°–∏—Å—Ç–µ–º–∞ –±–µ–∑ –Ω–∞–∑–≤–∞–Ω–∏—è";
            const metalState = sys.querySelector('.metal-state').value;
            const primerLayers = parseInt(sys.querySelector('.primer-layers').value) || 0;
            const ogzThk = parseFloat(sys.querySelector('.ogz-thk').value) || 0;
            const ogzMax = parseFloat(sys.querySelector('.ogz-max-layer').value) || 1500;
            const finishLayers = parseInt(sys.querySelector('.finish-layers').value) || 0;
            
            const meshType = sys.querySelector('.mesh-type').value;
            const meshVal = parseFloat(sys.querySelector('.mesh-value').value) || 0;

            const areaShop = parseFloat(sys.querySelector('.area-shop').value) || 0;
            const shopCoef = parseFloat(sys.querySelector('.shop-coef').value) || 1.0;
            
            const areaSite = parseFloat(sys.querySelector('.area-site').value) || 0;
            const accessCoef = parseFloat(sys.querySelector('.access-coef').value) || 1.0;

            const numElements = parseInt(sys.querySelector('.joint-elements').value) || 0;
            const jointsPerElement = parseInt(sys.querySelector('.joints-per-element').value) || 0;
            const jointArea = parseFloat(sys.querySelector('.joint-area').value) || 0;
            const jointsCoef = parseFloat(sys.querySelector('.joints-coef').value) || 1.0;

            // –†–∞—Å—á–µ—Ç —Å–ª–æ–µ–≤ –¥–ª—è —ç—Ç–æ–π —Å–∏—Å—Ç–µ–º—ã
            const ogzLayerCount = Math.ceil(ogzThk / ogzMax) || 0;
            let meshLayerTriggers = [];
            if (meshType === 'by_layer' && meshVal > 0) meshLayerTriggers.push(meshVal);
            else if (meshType === 'by_thickness' && meshVal > 0) {
                let currentThk = 0;
                for(let i=1; i<=ogzLayerCount; i++){
                    currentThk += ogzMax;
                    if(currentThk >= meshVal) { meshLayerTriggers.push(i); break; }
                }
            } else if (meshType === 'proportional' && meshVal > 0 && meshVal <= 1) {
                let targetThk = ogzThk * meshVal;
                let currentThk = 0;
                for(let i=1; i<=ogzLayerCount; i++){
                    currentThk += ogzMax;
                    if(currentThk >= targetThk) { meshLayerTriggers.push(i); break; }
                }
            }

            let shop = { l: 0, m: 0 };
            let site = { l: 0, m: 0 };
            let joint = { l: 0, m: 0 };

            function addHours(normName, multiplier, targetBlock, isJoint = false) {
                if(!isJoint) {
                    targetBlock.l += NORMS.solid[normName].labor * multiplier;
                    targetBlock.m += NORMS.solid[normName].machine * multiplier;
                } else {
                    let shifts = multiplier / NORMS.joints[normName];
                    targetBlock.l += shifts * shiftHours;
                }
            }

            // –ú–∞—Ç–µ–º–∞—Ç–∏–∫–∞ (–¢–æ—á–Ω–æ –∫–∞–∫ –≤ –í–µ—Ä—Å–∏–∏ 3.7)
            if(areaShop > 0) {
                let m = areaShop * shopCoef; 
                if(metalState === 'bare') { addHours('prep_sa25', m, shop); addHours('prep_dust', m, shop); addHours('prep_degrease', m, shop); } 
                else { addHours('prep_degrease', m, shop); }
                for(let i=0; i<primerLayers; i++) addHours('primer', m, shop);
                for(let i=1; i<=ogzLayerCount; i++) { addHours('ogz_layer', m, shop); if(meshLayerTriggers.includes(i)) { addHours('mesh', m, shop); addHours('mesh_spray', m, shop); } }
                for(let i=0; i<finishLayers; i++) addHours('finish', m, shop);
            }

            if(areaSite > 0) {
                let m = areaSite * accessCoef;
                if(metalState === 'bare') { addHours('prep_sa25', m, site); addHours('prep_dust', m, site); addHours('prep_degrease', m, site); } 
                else { addHours('prep_degrease', m, site); }
                for(let i=0; i<primerLayers; i++) addHours('primer', m, site);
                for(let i=1; i<=ogzLayerCount; i++) { addHours('ogz_layer', m, site); if(meshLayerTriggers.includes(i)) { addHours('mesh', m, site); addHours('mesh_spray', m, site); } }
                for(let i=0; i<finishLayers; i++) addHours('finish', m, site);
            }

            const totalJoints = numElements * jointsPerElement;
            const totalJointArea = totalJoints * jointArea;
            if(totalJoints > 0) {
                let jm = totalJoints * jointsCoef;
                if(metalState === 'bare') { addHours('prep_complex', jm, joint, true); } 
                else { addHours('prep_degrease', jm, joint, true); }
                for(let i=0; i<primerLayers; i++) addHours('primer', jm, joint, true);
                for(let i=1; i<=ogzLayerCount; i++) { addHours('ogz_layer', jm, joint, true); if(meshLayerTriggers.includes(i)) { addHours('mesh', jm, joint, true); addHours('mesh_spray', jm, joint, true); } }
                for(let i=0; i<finishLayers; i++) addHours('finish', jm, joint, true);
            }

            const shopEco = calcEconomics(shop.l, shop.m, kIndShop);
            const siteEco = calcEconomics(site.l, site.m, kIndSite);
            const jointEco = calcEconomics(joint.l, joint.m, kIndSite);

            // –ü–õ–Æ–°–£–ï–ú –í –ì–†–ê–ù–î –ò–¢–û–ì–û
            grandLabor += (shop.l + site.l + joint.l);
            grandMachine += (shop.m + site.m + joint.m);
            grandPrice += (shopEco.finalP + siteEco.finalP + jointEco.finalP);
            grandCost += (shopEco.market + siteEco.market + jointEco.market);

            // –ì–ï–ù–ï–†–ê–¶–ò–Ø HTML –î–õ–Ø –≠–¢–û–ô –°–ò–°–¢–ï–ú–´ (–µ—Å–ª–∏ –µ—Å—Ç—å –æ–±—ä–µ–º—ã)
            if (areaShop > 0 || areaSite > 0 || totalJoints > 0) {
                resultHTML += `<div class="sys-result"><div class="sys-result-title">üìã ${sysName} <span style="font-size: 14px; font-weight:normal; color:#666;">(–°–ª–æ–µ–≤ –û–ì–ó: ${ogzLayerCount})</span></div><div class="res-row">`;
                
                if(areaShop > 0) {
                    resultHTML += `
                    <div class="res-container shop">
                        <div class="res-title">üè≠ –¶–µ—Ö (${areaShop} –º¬≤)</div>
                        <div class="res-grid">
                            <div class="res-box"><span>–ß–ß –Ω–∞ 1 –º¬≤</span><strong>${fmtD(shop.l / areaShop)}</strong></div>
                            <div class="res-box"><span>–í—Å–µ–≥–æ –ß–ß</span><strong>${fmtD(shop.l)}</strong></div>
                            <div class="res-box main"><span>–¶–µ–Ω–∞ –∑–∞ 1 –º¬≤ (–°–º–µ—Ç–∞)</span><strong>${fmtM(shopEco.finalP / areaShop)} ‚ÇΩ</strong></div>
                            <div class="res-box"><span>–ò—Ç–æ–≥–æ –°–º–µ—Ç–∞</span><strong>${fmtM(shopEco.finalP)} ‚ÇΩ</strong></div>
                            <div class="res-box"><span>–°–µ–±–µ—Å—Ç–æ–∏–º–æ—Å—Ç—å</span><strong>${fmtM(shopEco.market)} ‚ÇΩ</strong></div>
                        </div>
                    </div>`;
                }

                if(areaSite > 0) {
                    resultHTML += `
                    <div class="res-container site">
                        <div class="res-title">üèóÔ∏è –ü–ª–æ—â–∞–¥–∫–∞ (${areaSite} –º¬≤)</div>
                        <div class="res-grid">
                            <div class="res-box"><span>–ß–ß –Ω–∞ 1 –º¬≤</span><strong>${fmtD(site.l / areaSite)}</strong></div>
                            <div class="res-box"><span>–í—Å–µ–≥–æ –ß–ß</span><strong>${fmtD(site.l)}</strong></div>
                            <div class="res-box main"><span>–¶–µ–Ω–∞ –∑–∞ 1 –º¬≤ (–°–º–µ—Ç–∞)</span><strong>${fmtM(siteEco.finalP / areaSite)} ‚ÇΩ</strong></div>
                            <div class="res-box"><span>–ò—Ç–æ–≥–æ –°–º–µ—Ç–∞</span><strong>${fmtM(siteEco.finalP)} ‚ÇΩ</strong></div>
                            <div class="res-box"><span>–°–µ–±–µ—Å—Ç–æ–∏–º–æ—Å—Ç—å</span><strong>${fmtM(siteEco.market)} ‚ÇΩ</strong></div>
                        </div>
                    </div>`;
                }

                if(totalJoints > 0) {
                    resultHTML += `
                    <div class="res-container joints">
                        <div class="res-title">üîó –°—Ç—ã–∫–∏ (${totalJoints} —à—Ç)</div>
                        <div class="res-grid">
                            <div class="res-box"><span>–ß–ß –Ω–∞ 1 —Å—Ç—ã–∫</span><strong>${fmtD(joint.l / totalJoints)}</strong></div>
                            <div class="res-box"><span>–í—Å–µ–≥–æ –ß–ß</span><strong>${fmtD(joint.l)}</strong></div>
                            <div class="res-box main"><span>–¶–µ–Ω–∞ 1 —Å—Ç—ã–∫–∞ (–°–º–µ—Ç–∞)</span><strong>${fmtM(jointEco.finalP / totalJoints)} ‚ÇΩ</strong></div>
                            <div class="res-box"><span>–ò—Ç–æ–≥–æ –°–º–µ—Ç–∞</span><strong>${fmtM(jointEco.finalP)} ‚ÇΩ</strong></div>
                            <div class="res-box"><span>–°–µ–±–µ—Å—Ç–æ–∏–º–æ—Å—Ç—å</span><strong>${fmtM(jointEco.market)} ‚ÇΩ</strong></div>
                        </div>
                    </div>`;
                }
                resultHTML += `</div></div>`; // –ó–∞–∫—Ä—ã–≤–∞–µ–º .res-row –∏ .sys-result
            }
        });

        // –î–û–ë–ê–í–õ–Ø–ï–ú –ì–†–ê–ù–î –ò–¢–û–ì–û –í HTML
        if (grandPrice > 0) {
            let grandProfit = grandPrice - grandCost; // –ì—Ä—É–±—ã–π —Ä–∞—Å—á–µ—Ç –ø—Ä–∏–±—ã–ª–∏
            
            resultHTML += `
            <div class="grand-total">
                <div class="grand-title">‚úÖ –°–í–û–î–ù–ê–Ø –°–ú–ï–¢–ê –ü–û –í–°–ï–ú–£ –û–ë–™–ï–ö–¢–£</div>
                <div class="gt-grid">
                    <div class="gt-box"><span>–í—Å–µ–≥–æ –¢—Ä—É–¥–æ–∑–∞—Ç—Ä–∞—Ç (–ß–ß / –ú–ß)</span><strong>${fmtD(grandLabor)} / ${fmtD(grandMachine)}</strong></div>
                    <div class="gt-box main"><span>–ò–¢–û–ì–û –ö –û–ü–õ–ê–¢–ï –ó–ê–ö–ê–ó–ß–ò–ö–û–ú</span><strong>${fmtM(grandPrice)} ‚ÇΩ</strong></div>
                    <div class="gt-box"><span>–†—ã–Ω–æ—á–Ω–∞—è –°–µ–±–µ—Å—Ç–æ–∏–º–æ—Å—Ç—å</span><strong>${fmtM(grandCost)} ‚ÇΩ</strong></div>
                    <div class="gt-box"><span>–ü—Ä–æ–≥–Ω–æ–∑–∏—Ä—É–µ–º–∞—è –ü—Ä–∏–±—ã–ª—å</span><strong style="color:var(--joints);">${fmtM(grandProfit)} ‚ÇΩ</strong></div>
                </div>
            </div>`;
        } else {
            resultHTML = "<h3 style='text-align:center; color:red;'>–í–≤–µ–¥–∏—Ç–µ –æ–±—ä–µ–º—ã —Ö–æ—Ç—è –±—ã –≤ –æ–¥–Ω—É —Å–∏—Å—Ç–µ–º—É!</h3>";
        }

        const resSec = document.getElementById('result-section');
        resSec.innerHTML = resultHTML;
        resSec.style.display = 'block';
        resSec.scrollIntoView({ behavior: 'smooth' });
    }
</script>

</body>

</html>
